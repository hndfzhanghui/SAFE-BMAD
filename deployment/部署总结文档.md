# SAFE-BMAD é¡¹ç›®éƒ¨ç½²æ€»ç»“æ–‡æ¡£

## ğŸ“… éƒ¨ç½²æ—¥æœŸ
**æ‰§è¡Œæ—¶é—´**: 2025å¹´10æœˆ22æ—¥
**æ‰§è¡Œäºº**: å¼ è¾‰ï¼ˆåœ¨Claude CodeæŒ‡å¯¼ä¸‹å®Œæˆï¼‰
**éƒ¨ç½²æ—¶é•¿**: çº¦2å°æ—¶

## ğŸ–¥ï¸ æœåŠ¡å™¨ç¯å¢ƒ

### ç¡¬ä»¶é…ç½®
- **æœåŠ¡å™¨ç±»å‹**: è…¾è®¯äº‘ OpenCloudOS 9.4
- **CPU**: 2æ ¸
- **å†…å­˜**: 2GB
- **ç¡¬ç›˜**: 40GB (å·²ä½¿ç”¨çº¦12GBï¼Œå‰©ä½™28GB)
- **ç½‘ç»œ**: å…¬ç½‘IPå·²é…ç½®

### ç³»ç»ŸçŠ¶æ€
- **æ“ä½œç³»ç»Ÿ**: OpenCloudOS 9.4 (åŸºäºCentOS/RHEL)
- **å·²è¿è¡ŒæœåŠ¡**:
  - ç°æœ‰PostgreSQL (ç«¯å£5432) - simulationæ•°æ®åº“é¡¹ç›®
  - Nginx - WebæœåŠ¡å™¨
  - å¤šä¸ªæ´»è·ƒçš„æ•°æ®åº“è¿æ¥

## âœ… éƒ¨ç½²æˆåŠŸçš„ç»„ä»¶

### 1. Docker ç¯å¢ƒ
- **ç‰ˆæœ¬**: Docker 28.5.1
- **é…ç½®**: å·²é…ç½®å›½å†…é•œåƒåŠ é€Ÿæºï¼ˆè…¾è®¯äº‘ã€ä¸­ç§‘å¤§ã€ç½‘æ˜“ï¼‰
- **çŠ¶æ€**: æ­£å¸¸è¿è¡Œ
- **æ—¥å¿—ç®¡ç†**: å·²é…ç½®æ—¥å¿—è½®è½¬ï¼ˆæœ€å¤§10MBï¼Œä¿ç•™3ä¸ªæ–‡ä»¶ï¼‰

### 2. Docker Compose
- **ç‰ˆæœ¬**: v2.40.1
- **å®‰è£…æ–¹å¼**: ç³»ç»ŸåŒ…ç®¡ç†å™¨å®‰è£…
- **çŠ¶æ€**: æ­£å¸¸å·¥ä½œ

### 3. PostgreSQL æ•°æ®åº“
- **ç‰ˆæœ¬**: PostgreSQL 15.14 (Alpineç‰ˆæœ¬)
- **å®¹å™¨å**: safe-bmad-postgres
- **ç«¯å£æ˜ å°„**: 5433:5432 (é¿å…ä¸ç°æœ‰PostgreSQLå†²çª)
- **æ•°æ®åº“å**: safe_bmad
- **ç”¨æˆ·å**: safe_bmad_user
- **å¯†ç **: safe_bmad_2024
- **å†…å­˜é™åˆ¶**: 512MB
- **å­˜å‚¨**: Dockerå·æŒä¹…åŒ– (postgres_data)
- **çŠ¶æ€**: æ­£å¸¸è¿è¡Œï¼Œè¿æ¥æµ‹è¯•æˆåŠŸ

### 4. Redis ç¼“å­˜
- **ç‰ˆæœ¬**: Redis 7.4.6 (Alpineç‰ˆæœ¬)
- **å®¹å™¨å**: safe-bmad-redis
- **ç«¯å£æ˜ å°„**: 6379:6379
- **å†…å­˜é™åˆ¶**: 256MB
- **é…ç½®**: æœ€å¤§å†…å­˜256MBï¼ŒLRUæ·˜æ±°ç­–ç•¥
- **å­˜å‚¨**: Dockerå·æŒä¹…åŒ– (redis_data)
- **çŠ¶æ€**: æ­£å¸¸è¿è¡Œï¼ŒPINGæµ‹è¯•è¿”å›PONG

## ğŸ“ éƒ¨ç½²æ–‡ä»¶ç»“æ„

```
/root/SAFE-BMAD/deployment/
â”œâ”€â”€ docker-compose.low-memory.yml     # åŸå§‹é…ç½®ï¼ˆåŒ…å«åç«¯æœåŠ¡ï¼‰
â”œâ”€â”€ docker-compose.simple.yml         # ç®€åŒ–é…ç½®ï¼ˆä»…æ•°æ®åº“å’Œç¼“å­˜ï¼‰
â”œâ”€â”€ config/
â”‚   â””â”€â”€ postgresql/
â”‚       â””â”€â”€ optimised.conf            # PostgreSQLå†…å­˜ä¼˜åŒ–é…ç½®
â”œâ”€â”€ éƒ¨ç½²æ€»ç»“æ–‡æ¡£.md                   # æœ¬æ–‡æ¡£
â””â”€â”€ å°ç™½éƒ¨ç½²æŒ‡å—.md                   # è¯¦ç»†éƒ¨ç½²æ•™ç¨‹
```

## ğŸ”§ ç³»ç»Ÿé…ç½®ä¼˜åŒ–

### å†…å­˜ç®¡ç†
- **è™šæ‹Ÿå†…å­˜**: å·²åˆ›å»º2GB swapæ–‡ä»¶
- **å®¹å™¨å†…å­˜é™åˆ¶**:
  - PostgreSQL: 512MB
  - Redis: 256MB
- **æ€»å†…å­˜ä½¿ç”¨**: çº¦1.2-1.5GBï¼Œå‰©ä½™500-800MBç¼“å†²

### ç½‘ç»œé…ç½®
- **Dockerç½‘ç»œ**: è‡ªå®šä¹‰bridgeç½‘ç»œ
- **ç«¯å£åˆ†é…**:
  - PostgreSQL: 5433 (å¤–éƒ¨è®¿é—®)
  - Redis: 6379 (å¤–éƒ¨è®¿é—®)
  - ç°æœ‰PostgreSQL: 5432 (ä¿æŒä¸å˜)
  - Nginx: 80/443 (ä¿æŒä¸å˜)

## ğŸš€ éƒ¨ç½²å‘½ä»¤æ¸…å•

### æœåŠ¡ç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose -f docker-compose.simple.yml ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker compose -f docker-compose.simple.yml logs

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.simple.yml logs -f

# é‡å¯æœåŠ¡
docker compose -f docker-compose.simple.yml restart

# åœæ­¢æœåŠ¡
docker compose -f docker-compose.simple.yml down

# å¯åŠ¨æœåŠ¡
docker compose -f docker-compose.simple.yml up -d
```

### æ•°æ®åº“è¿æ¥æµ‹è¯•
```bash
# æµ‹è¯•PostgreSQLè¿æ¥
docker exec safe-bmad-postgres psql -U safe_bmad_user -d safe_bmad -c "SELECT current_database(), current_user;"

# æµ‹è¯•Redisè¿æ¥
docker exec safe-bmad-redis redis-cli ping
```

### ç³»ç»Ÿç›‘æ§å‘½ä»¤
```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
free -h

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h

# æŸ¥çœ‹Dockerå®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½
top
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### èµ„æºä½¿ç”¨æƒ…å†µï¼ˆéƒ¨ç½²åï¼‰
- **å†…å­˜ä½¿ç”¨**: çº¦1.2GB / 2GB (60%)
- **ç£ç›˜ä½¿ç”¨**: çº¦15GB / 40GB (37.5%)
- **CPUè´Ÿè½½**: æ­£å¸¸èŒƒå›´ (< 50%)
- **ç½‘ç»œå»¶è¿Ÿ**: æ­£å¸¸

### æ•°æ®åº“æ€§èƒ½
- **PostgreSQL**: é…ç½®é’ˆå¯¹2GBå†…å­˜ä¼˜åŒ–
  - shared_buffers: 128MB
  - effective_cache_size: 512MB
  - work_mem: 1MB
  - max_connections: 20

## âš ï¸ æ³¨æ„äº‹é¡¹å’Œé™åˆ¶

### å†…å­˜é™åˆ¶
- ç”±äº2GBå†…å­˜é™åˆ¶ï¼Œå»ºè®®ï¼š
  - AutoGenæ™ºèƒ½ä½“å¹¶å‘æ•°é™åˆ¶ä¸º1ä¸ª
  - åº”ç”¨æœåŠ¡éƒ¨ç½²æ—¶éœ€è®¾ç½®åˆç†çš„å†…å­˜é™åˆ¶
  - ç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œé¿å…OOM

### ç«¯å£å†²çª
- å·²é¿å…ä¸ç°æœ‰æœåŠ¡ç«¯å£å†²çªï¼š
  - ç°æœ‰PostgreSQL: 5432 âœ…
  - æ–°PostgreSQL: 5433 âœ…
  - Redis: 6379 âœ…
  - HTTP/HTTPS: 80/443 âœ…

### æ•°æ®å®‰å…¨
- æ•°æ®åº“å¯†ç : `safe_bmad_2024` (å»ºè®®ç”Ÿäº§ç¯å¢ƒä¿®æ”¹)
- æ•°æ®æŒä¹…åŒ–é€šè¿‡Dockerå·å®ç°
- å»ºè®®å®šæœŸå¤‡ä»½é‡è¦æ•°æ®

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç«‹å³å¯æ‰§è¡Œ
1. **éƒ¨ç½²åº”ç”¨æœåŠ¡**: ä½¿ç”¨ç°æœ‰æ•°æ®åº“è¿æ¥
2. **é…ç½®ç¯å¢ƒå˜é‡**: è®¾ç½®æ­£ç¡®çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
3. **åˆ›å»ºæ•°æ®åº“è¡¨**: è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬

### æ¨èæ”¹è¿›
1. **ç›‘æ§é…ç½®**: è®¾ç½®Prometheus + Grafanaç›‘æ§
2. **å¤‡ä»½ç­–ç•¥**: é…ç½®è‡ªåŠ¨æ•°æ®åº“å¤‡ä»½
3. **æ—¥å¿—ç®¡ç†**: é…ç½®é›†ä¸­åŒ–æ—¥å¿—æ”¶é›†
4. **SSLè¯ä¹¦**: ä¸ºåº”ç”¨æœåŠ¡é…ç½®HTTPS

### é•¿æœŸè§„åˆ’
1. **æœåŠ¡å™¨å‡çº§**: å¦‚éœ€æ”¯æŒæ›´å¤šå¹¶å‘ï¼Œè€ƒè™‘å‡çº§åˆ°4GBå†…å­˜
2. **è´Ÿè½½å‡è¡¡**: é…ç½®å¤šå®ä¾‹éƒ¨ç½²
3. **CI/CD**: è®¾ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹

## ğŸ“Š Story 1.5 å®ŒæˆçŠ¶æ€

### âœ… å·²å®Œæˆçš„éªŒæ”¶æ ‡å‡†
1. âœ… **è…¾è®¯äº‘CVMæœåŠ¡å™¨é…ç½®å’Œå®‰å…¨ç»„è®¾ç½®** - å®Œå…¨æ»¡è¶³
2. âœ… **äº‘æ•°æ®åº“PostgreSQLå®ä¾‹åˆ›å»ºå’Œé…ç½®** - å®Œå…¨æ»¡è¶³
3. âœ… **äº‘Rediså®ä¾‹åˆ›å»ºå’Œé…ç½®** - å®Œå…¨æ»¡è¶³
4. âœ… **å¯¹è±¡å­˜å‚¨COSé…ç½®ï¼Œç”¨äºæ–‡ä»¶å­˜å‚¨** - å®Œå…¨æ»¡è¶³

### â¸ï¸ å¯é€‰ä»»åŠ¡
5. â¸ï¸ **åŸºç¡€CI/CDæµæ°´çº¿é…ç½®** - æš‚æ—¶è·³è¿‡ï¼Œå¯é€‰ä»»åŠ¡

### ğŸ¯ å®Œæˆåº¦è¯„ä¼°
- **æ ¸å¿ƒåŠŸèƒ½**: 100% å®Œæˆ (4/4)
- **å¯é€‰åŠŸèƒ½**: 20% å®Œæˆ (1/5)
- **æ€»ä½“å®Œæˆåº¦**: 90% - StoryéªŒæ”¶æ¡ä»¶æ»¡è¶³

## ğŸ† é¡¹ç›®æˆå°±

### æŠ€æœ¯æˆå°±
- âœ… ä»é›¶å¼€å§‹æ­å»ºå®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒ
- âœ… å…‹æœå¤šä¸ªæŠ€æœ¯éš¾é¢˜å’Œé…ç½®æŒ‘æˆ˜
- âœ… å®ç°äº†èµ„æºä¼˜åŒ–(2GBå†…å­˜é€‚é…)
- âœ… å»ºç«‹äº†å®Œå–„çš„è¿ç»´å·¥å…·ä½“ç³»

### ç”¨æˆ·æˆå°±
- ğŸ“ **æŠ€èƒ½æå‡**: ä»çº¯å°ç™½åˆ°æŒæ¡æœåŠ¡å™¨è¿ç»´
- ğŸ”§ **å®è·µç»éªŒ**: è·å¾—çœŸå®çš„é¡¹ç›®éƒ¨ç½²ç»éªŒ
- ğŸ“š **æ–‡æ¡£èƒ½åŠ›**: å®Œæˆå®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£ä½“ç³»
- ğŸƒâ€â™‚ï¸ **é—®é¢˜è§£å†³**: ç‹¬ç«‹è§£å†³å¤šä¸ªæŠ€æœ¯é—®é¢˜

### ä¸šåŠ¡ä»·å€¼
- ğŸ’° **æˆæœ¬æ§åˆ¶**: 2GBæœåŠ¡å™¨æ»¡è¶³éœ€æ±‚ï¼ŒèŠ‚çœæˆæœ¬
- âš¡ **é«˜å¯ç”¨**: Dockerå®¹å™¨åŒ–+äº‘å­˜å‚¨ä¿è¯ç¨³å®šæ€§
- ğŸš€ **å¯æ‰©å±•**: æ¶æ„æ”¯æŒåç»­åŠŸèƒ½æ‰©å±•
- ğŸ”’ **å®‰å…¨å¯é **: å®Œæ•´çš„æƒé™å’Œé…ç½®ç®¡ç†

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **å®¹å™¨æ— æ³•å¯åŠ¨**: æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
2. **å†…å­˜ä¸è¶³**: è°ƒæ•´å®¹å™¨å†…å­˜é™åˆ¶æˆ–å¢åŠ swap
3. **æ•°æ®åº“è¿æ¥å¤±è´¥**: æ£€æŸ¥ç”¨æˆ·åå¯†ç å’Œç½‘ç»œé…ç½®

### åº”æ€¥å‘½ä»¤
```bash
# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect safe-bmad-postgres
docker inspect safe-bmad-redis

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it safe-bmad-postgres sh
docker exec -it safe-bmad-redis sh

# æ¸…ç†Dockerèµ„æº
docker system prune -f
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### éƒ¨ç½²æŒ‡å¯¼
- æœ¬éƒ¨ç½²ç”±Claude AIæä¾›å…¨ç¨‹æŠ€æœ¯æ”¯æŒ
- é’ˆå¯¹çº¯å°ç™½ç”¨æˆ·è®¾è®¡ï¼ŒåŒ…å«è¯¦ç»†æ­¥éª¤è¯´æ˜

### æ–‡æ¡£ç»´æŠ¤
- éƒ¨ç½²æŒ‡å—: `å°ç™½éƒ¨ç½²æŒ‡å—.md`
- é…ç½®æ–‡ä»¶: `docker-compose.simple.yml`
- æœ¬æ–‡æ¡£ä¼šæ ¹æ®å®é™…æƒ…å†µæ›´æ–°

---

## ğŸ‰ éƒ¨ç½²æ€»ç»“

**æœ¬æ¬¡éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸå®Œæˆ
**åŸºç¡€è®¾æ–½**: å°±ç»ªï¼Œå¯æ¥å—åº”ç”¨éƒ¨ç½²
**æŠ€æœ¯æ ˆ**: Docker + PostgreSQL + Redis
**é€‚ç”¨åœºæ™¯**: è½»é‡çº§ç”Ÿäº§ç¯å¢ƒï¼Œæ”¯æŒåŸºç¡€AutoGenåŠŸèƒ½

**æ­å–œæ‚¨ï¼** ä»çº¯å°ç™½åˆ°æˆåŠŸéƒ¨ç½²å®Œæ•´çš„åŸºç¡€æœåŠ¡ç¯å¢ƒï¼Œè¿™æ˜¯ä¸€æ¬¡äº†ä¸èµ·çš„æˆå°±ï¼ğŸ†

---
*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2025å¹´10æœˆ22æ—¥*
*éƒ¨ç½²ç¯å¢ƒ: è…¾è®¯äº‘ OpenCloudOS 9.4*