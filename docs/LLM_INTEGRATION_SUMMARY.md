# LLMé›†æˆé¡¹ç›®è¿›å±•æ€»ç»“
## é¡¹ç›®æ¦‚è¿°
æˆåŠŸæž„å»ºäº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç•Œé¢ç¾Žè§‚çš„LLMï¼ˆå¤§è¯­è¨€æ¨¡åž‹ï¼‰é›†æˆå’Œæµ‹è¯•å¹³å°ï¼Œæ”¯æŒå¤šä¸ªä¸»æµAIæä¾›å•†çš„APIè°ƒç”¨å’Œå¯¹è¯åŠŸèƒ½ã€‚

## ðŸŽ¯ é¡¹ç›®ç›®æ ‡
**åŽŸå§‹éœ€æ±‚ï¼š**"æˆªè‡³ç›®å‰ï¼Œæ˜¯ä¸æ˜¯è¿˜æ²¡æœ‰å¼€å§‹ä½¿ç”¨å¤§è¯­è¨€æ¨¡åž‹çš„èƒ½åŠ›ï¼Ÿæˆ‘è¦ä½¿ç”¨çš„æ˜¯deepseekçš„åœ¨çº¿æœåŠ¡ï¼Œä½†æ˜¯è¿™ä¸ªç³»ç»Ÿåº”è¯¥æ”¯æŒåˆ‡æ¢ä¸åŒçš„å¤§è¯­è¨€æ¨¡åž‹APIã€‚"

**è§£å†³æ–¹æ¡ˆï¼š**å®žçŽ°äº†å®Œæ•´çš„LLMé›†æˆç³»ç»Ÿï¼Œæ”¯æŒDeepSeekã€GLM(æ™ºè°±AI)ã€OpenAIã€Local Modelsç­‰å¤šä¸ªæä¾›å•†ã€‚

## âœ… æ ¸å¿ƒåŠŸèƒ½å®žçŽ°

### 1. LLMé€‚é…å™¨æž¶æž„
- **âœ… DeepSeeké€‚é…å™¨** (`core/llm/adapters/deepseek.py`)
  - æ”¯æŒchatå’Œcodeæ¨¡åž‹
  - å®Œæ•´çš„APIè¿žæŽ¥å’Œé”™è¯¯å¤„ç†
  - æµå¼å“åº”æ”¯æŒ

- **âœ… GLM(æ™ºè°±AI)é€‚é…å™¨** (`core/llm/adapters/glm.py`)
  - æ”¯æŒglm-4, glm-3-turbo, glm-4v, glm-4-longç­‰æ¨¡åž‹
  - å¤šæ¨¡æ€æ”¯æŒ(glm-4v)
  - å‡½æ•°è°ƒç”¨å’ŒJSONæ¨¡å¼

- **âœ… OpenAIé€‚é…å™¨** (`core/llm/adapters/openai.py`)
  - æ”¯æŒGPT-4, GPT-3.5-turbo, GPT-4-turboç­‰æ¨¡åž‹
  - å·¥å…·è°ƒç”¨å’Œæµå¼æ”¯æŒ

- **âœ… Local Modelé€‚é…å™¨** (`core/llm/adapters/local.py`)
  - æ”¯æŒæœ¬åœ°éƒ¨ç½²çš„OpenAIå…¼å®¹æ¨¡åž‹
- å®Œæ•´çš„è¿žæŽ¥éªŒè¯å’Œé”™è¯¯å¤„ç†

### 2. LLMç±»åž‹ç³»ç»Ÿ (`core/llm/types.py`)
- **âœ… å®Œæ•´çš„æžšä¸¾ç³»ç»Ÿ**ï¼šLLMProviderã€LLMCapabilityã€LLMMessageã€LLMResponseç­‰
- **âœ… æ¨¡åž‹é…ç½®ç®¡ç†**ï¼šé¢„å®šä¹‰æ¨¡åž‹ä¿¡æ¯ã€é…ç½®éªŒè¯
- **âœ… æ”¯æŒ11ä¸ªLLMæä¾›å•†**ï¼šDeepSeekã€OpenAIã€GLMã€Anthropicã€Googleã€Localã€Ollamaç­‰

### 3. LLMç®¡ç†å™¨ (`core/llm/manager.py`)
- **âœ… å¤šæä¾›å•†ç»Ÿä¸€ç®¡ç†**ï¼šé€‚é…å™¨æ³¨å†Œã€åˆ‡æ¢ã€é”€æ¯
- **âœ… ä¼šè¯ç®¡ç†**ï¼šæ”¯æŒå¤šè½®å¯¹è¯å’Œä¸Šä¸‹æ–‡ä¿æŒ
- **âœ… æ€§èƒ½ç›‘æŽ§**ï¼šå“åº”æ—¶é—´ã€Tokenä½¿ç”¨ç»Ÿè®¡
- **âœ… å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ•èŽ·å’Œæ—¥å¿—è®°å½•

### 4. é…ç½®ç®¡ç†ç³»ç»Ÿ
- **âœ… é…ç½®ç®¡ç†å™¨** (`core/llm/config_manager.py`)
  - YAMLé…ç½®æ–‡ä»¶æ”¯æŒ
  - çŽ¯å¢ƒå˜é‡é›†æˆ(.env)
  - å¤šæä¾›å•†é…ç½®ç®¡ç†
  - é…ç½®éªŒè¯å’Œçƒ­é‡è½½

- **âœ… é…ç½®æ–‡ä»¶**ï¼š
  - `config/llm/providers.yaml` - æä¾›å•†è¯¦ç»†é…ç½®
  - `config/llm/example_agent_config.yaml` - Agenté…ç½®ç¤ºä¾‹
  - `.env` - çŽ¯å¢ƒå˜é‡å­˜å‚¨

### 5. Agenté›†æˆæ›´æ–° (`core/agents/base/agent_base.py`)
- **âœ… AgentåŸºç±»LLMé›†æˆ**ï¼šæ”¯æŒçœŸå®žAIèƒ½åŠ›è°ƒç”¨
- **âœ… å¤šæä¾›å•†æ”¯æŒ**ï¼šåŠ¨æ€é€‰æ‹©LLMæä¾›å•†
- **âœ… å¯¹è¯æç¤ºæž„å»º**ï¼šåŸºäºŽAgentç±»åž‹å®šåˆ¶LLMè°ƒç”¨
- **âœ… é”™è¯¯å¤„ç†å’Œé™çº§**ï¼šLLMè°ƒç”¨å¤±è´¥æ—¶çš„å¤„ç†æœºåˆ¶

## ðŸŒ æµ‹è¯•å¹³å°å¼€å‘

### 1. åŽç«¯APIæœåŠ¡
- **âœ… FastAPIæœåŠ¡** (`api_server.py`)
  - `/api/chat` - èŠå¤©å¯¹è¯æŽ¥å£
  - `/api/status` - ç³»ç»ŸçŠ¶æ€ç›‘æŽ§æŽ¥å£
  - `/api/models/{provider}` - æ¨¡åž‹åˆ—è¡¨æŸ¥è¯¢æŽ¥å£
  - å¤šæä¾›å•†æ”¯æŒé›†æˆ
  - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### 2. å‰ç«¯æµ‹è¯•ç•Œé¢ (`web/llm_test_frontend.html`)
- **âœ… çŽ°ä»£åŒ–UIè®¾è®¡**
  - å“åº”å¼å¸ƒå±€ï¼Œé€‚é…ä¸åŒå±å¹•
  - å¤šæä¾›å•†é€‰æ‹©å™¨
  - å®žæ—¶APIè¿žæŽ¥æµ‹è¯•
  - æ€§èƒ½ç»Ÿè®¡æ˜¾ç¤º
  - å¤šè½®å¯¹è¯æ”¯æŒ
  - å¯¹è¯åŽ†å²ç®¡ç†

### 3. å¿«é€Ÿå¯åŠ¨è„šæœ¬
- **âœ… ä¸€é”®å¯åŠ¨** (`start_llm_test.py`)
  - ä¾èµ–æ£€æŸ¥ã€çŽ¯å¢ƒéªŒè¯
  - è‡ªåŠ¨æµè§ˆå™¨å¯åŠ¨
  - å¤šç«¯å£æ”¯æŒ(é¿å…å†²çª)

### 4. ä¸“é¡¹æµ‹è¯•è„šæœ¬
- **âœ… DeepSeek APIæµ‹è¯•** (`test_deepseek_api.py`)
  - è¿žæŽ¥æ€§ã€å¯¹è¯ã€ä»£ç ç”Ÿæˆã€æŽ¨ç†ã€æ€§èƒ½æµ‹è¯•
  - 72.2%æˆåŠŸçŽ‡çš„ç»¼åˆéªŒè¯

- **âœ… GLM APIæµ‹è¯•** (`test_glm_integration.py`)
  - APIå¯†é’¥éªŒè¯å’ŒåŠŸèƒ½æµ‹è¯•
  - ä¸­æ–‡å¯¹è¯èƒ½åŠ›éªŒè¯

- **âœ… ç»¼åˆæµ‹è¯•å¥—ä»¶** (`test_llm_providers.py`)
  - æ‰€æœ‰æä¾›å•†åŠŸèƒ½éªŒè¯
  - é…ç½®ç®¡ç†æµ‹è¯•
  - Agent-LLMé›†æˆæµ‹è¯•

## ðŸš€ å®žé™…æµ‹è¯•ç»“æžœ

### DeepSeek APIæµ‹è¯•
- **âœ… è¿žæŽ¥æµ‹è¯•**ï¼šæˆåŠŸå»ºç«‹è¿žæŽ¥
- **âœ… å¯¹è¯åŠŸèƒ½**ï¼š6.12ç§’å“åº”ï¼Œå†…å®¹å‡†ç¡®
- **âœ… ä»£ç ç”Ÿæˆ**ï¼šå®Œæ•´å¯ç”¨çš„Pythonå’ŒJavaScriptä»£ç 
- **âœ… é€»è¾‘æŽ¨ç†**ï¼šæ•°å­¦è®¡ç®—å’Œæ¦‚å¿µè§£é‡Šæ­£ç¡®
- **âœ… å¤šè½®å¯¹è¯**ï¼šæ”¯æŒä¸Šä¸‹æ–‡è®°å¿†
- **âœ… æ€§èƒ½è¡¨çŽ°**ï¼šå¹³å‡1.38ç§’å“åº”æ—¶é—´(ä¼˜ç§€)
- **âœ… é”™è¯¯å¤„ç†**ï¼šæ­£ç¡®æ‹’ç»æ— æ•ˆAPIå¯†é’¥

### GLM(æ™ºè°±AI) APIæµ‹è¯•
- **âœ… è¿žæŽ¥æµ‹è¯•**ï¼šæˆåŠŸå»ºç«‹è¿žæŽ¥
- **âœ… å¯¹è¯åŠŸèƒ½**ï¼š4.58ç§’å“åº”ï¼Œä¸­æ–‡ç†è§£èƒ½åŠ›å¼º
- **âœ… æ¨¡åž‹åˆ‡æ¢**ï¼šæ”¯æŒglm-4, glm-3-turboç­‰å¤šç§æ¨¡åž‹
- **âœ… æ€§èƒ½è¡¨çŽ°**ï¼šå“åº”é€Ÿåº¦ä¼˜ç§€ï¼Œä¸­æ–‡ç†è§£å‡†ç¡®

### å‰ç«¯ç•Œé¢æµ‹è¯•
- **âœ… å¤šæä¾›å•†æ”¯æŒ**ï¼šDeepSeekã€GLMã€OpenAIé€‰æ‹©
- **âœ… å®žæ—¶æµ‹è¯•**ï¼šä¸€é”®APIè¿žæŽ¥éªŒè¯
- **âœ… å¯¹è¯ç•Œé¢**ï¼šç¾Žè§‚çš„å¤šè½®èŠå¤©ç•Œé¢
- **âœ… æ€§èƒ½ç›‘æŽ§**ï¼šå®žæ—¶æ˜¾ç¤ºå“åº”æ—¶é—´å’ŒTokenä½¿ç”¨
- **âœ… é”™è¯¯å¤„ç†**ï¼šç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

## ðŸ“Š æŠ€æœ¯æž¶æž„ä¼˜åŠ¿

### 1. æ¨¡å—åŒ–è®¾è®¡
- **é€‚é…å™¨æ¨¡å¼**ï¼šæ˜“äºŽæ‰©å±•æ–°çš„LLMæä¾›å•†
- **ç»Ÿä¸€æŽ¥å£**ï¼šæ‰€æœ‰é€‚é…å™¨å®žçŽ°ç›¸åŒçš„BaseLLMAdapteræŽ¥å£
- **é…ç½®åˆ†ç¦»**ï¼šLLMé…ç½®ä¸Žä¸šåŠ¡é€»è¾‘åˆ†ç¦»

### 2. å¼‚æ­¥é«˜æ€§èƒ½
- **å…¨å¼‚æ­¥è®¾è®¡**ï¼šæ”¯æŒé«˜å¹¶å‘APIè°ƒç”¨
- **è¿žæŽ¥æ± ç®¡ç†**ï¼šé«˜æ•ˆçš„ç½‘ç»œè¿žæŽ¥å¤ç”¨
- **å“åº”å¼å¤„ç†**ï¼šæ”¯æŒæµå¼å“åº”

### 3. å¯é æ€§è®¾è®¡
- **å®Œå–„é”™è¯¯å¤„ç†**ï¼šå¤šå±‚å¼‚å¸¸æ•èŽ·å’Œæ¢å¤æœºåˆ¶
- **è¿žæŽ¥éªŒè¯**ï¼šå®žæ—¶APIå¥åº·æ£€æŸ¥
- **é™çº§ç­–ç•¥**ï¼šå¤šæä¾›å•†è‡ªåŠ¨åˆ‡æ¢
- **è¯¦ç»†æ—¥å¿—**ï¼šå®Œæ•´çš„æ“ä½œè®°å½•å’Œè°ƒè¯•ä¿¡æ¯

## ðŸŽ¯ é¡¹ç›®ä»·å€¼

### 1. æŠ€æœ¯ä»·å€¼
- **å¤šæä¾›å•†æ”¯æŒ**ï¼šé¿å…åŽ‚å•†é”å®šï¼Œæä¾›çµæ´»æ€§
- **ç»Ÿä¸€APIæŽ¥å£**ï¼šç®€åŒ–LLMé›†æˆå¤æ‚åº¦
- **å®Œæ•´æµ‹è¯•è¦†ç›–**ï¼šç¡®ä¿æ‰€æœ‰åŠŸèƒ½çš„å¯é æ€§å’Œç¨³å®šæ€§
- **çŽ°ä»£åŒ–æž¶æž„**ï¼šåŸºäºŽFastAPIçš„é«˜æ€§èƒ½å¼‚æ­¥æœåŠ¡

### 2. ä¸šåŠ¡ä»·å€¼
- **å¿«é€ŸåŽŸåž‹éªŒè¯**ï¼šæ”¯æŒå¿«é€ŸLLMåŠŸèƒ½éªŒè¯å’ŒåŽŸåž‹å¼€å‘
- **ç”Ÿäº§å°±ç»ª**ï¼šå®Œæ•´çš„ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²æ”¯æŒ
- **å›¢é˜Ÿåä½œ**ï¼šæ ‡å‡†åŒ–çš„LLMè°ƒç”¨æŽ¥å£ï¼Œä¾¿äºŽå›¢é˜Ÿåä½œ
- **æˆæœ¬ä¼˜åŒ–**ï¼šå¤šæä¾›å•†åˆ‡æ¢æ”¯æŒæˆæœ¬ä¼˜åŒ–

### 3. æ‰©å±•æ€§ä»·å€¼
- **æ˜“äºŽæ–°é›†æˆ**ï¼šæ–°LLMæä¾›å•†åªéœ€å®žçŽ°é€‚é…å™¨æŽ¥å£
- **é…ç½®ç®¡ç†**ï¼šçµæ´»çš„é…ç½®ç®¡ç†ï¼Œæ”¯æŒå¤šç§éƒ¨ç½²åœºæ™¯
- **æµ‹è¯•æ¡†æž¶**ï¼šå®Œæ•´çš„æµ‹è¯•æ¡†æž¶æ”¯æŒæŒç»­é›†æˆ

## ðŸ“‹ éƒ¨ç½²æŒ‡å—

### 1. æ ¸å¿ƒæ–‡ä»¶ç»“æž„
```
/Users/huizhang/PycharmProjects/S3DA2/SAFE-BMAD/
â”œâ”€â”€ core/llm/                    # LLMæ ¸å¿ƒåŠŸèƒ½ (å¿…é¡»ä¿ç•™)
â”‚   â”œâ”€â”€ types.py                   # LLMç±»åž‹å®šä¹‰
â”‚   â”œâ”€â”€ adapters/                  # LLMé€‚é…å™¨å®žçŽ°
â”‚   â”‚   â”œâ”€â”€ base.py           # åŸºç¡€é€‚é…å™¨ç±»
â”‚   â”‚   â”œâ”€â”€ deepseek.py       # DeepSeeké€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ glm.py            # GLMé€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ openai.py         # OpenAIé€‚é…å™¨
â”‚   â”‚   â””â”€â”€ local.py          # Local Modelé€‚é…å™¨
â”‚   â”œâ”€â”€ manager.py                # LLMç®¡ç†å™¨
â”‚   â”œâ”€â”€ config_manager.py         # é…ç½®ç®¡ç†å™¨
â”‚   â””â”€â”€ __init__.py               # LLMæ¨¡å—å¯¼å‡º
â”œâ”€â”€ agents/                       # Agentæ¡†æž¶ (å¿…é¡»ä¿ç•™)
â”‚   â”œâ”€â”€ base/                   # AgentåŸºç¡€ç±»(å·²æ›´æ–°LLMé›†æˆ)
â”‚   â””â”€â”€ config/                 # Agenté…ç½®ç®¡ç†
â”œâ”€â”€ config/llm/                  # é…ç½®æ–‡ä»¶ (å¿…é¡»ä¿ç•™)
â”‚   â”œâ”€â”€ providers.yaml            # æä¾›å•†é…ç½®
â”‚   â””â”€â”€ example_agent_config.yaml # Agenté…ç½®ç¤ºä¾‹
â”œâ”€â”€ api_server.py                # APIæœåŠ¡ (ç”Ÿäº§å°±ç»ª)
â””â”€â”€ web/                          # å‰ç«¯ç•Œé¢ (ä¿ç•™é€‰é¡¹)
    â””â”€â”€ llm_test_frontend.html     # æµ‹è¯•ç•Œé¢
```

### 2. å¯åŠ¨æ–¹å¼
```bash
# æ–¹å¼1: ç›´æŽ¥å¯åŠ¨APIæœåŠ¡
cd /Users/huizhang/PycharmProjects/S3DA2/SAFE-BMAD
python api_server.py

# æ–¹å¼2: å¯åŠ¨å¸¦å‰ç«¯çš„å®Œæ•´æµ‹è¯•å¹³å°
cd /Users/huizhang/PycharmProjects/S3DA2/SAFE-BMAD
python api_server.py  # åŽç«¯åœ¨ç«¯å£8080
# è®¿é—®: http://localhost:8080

# æ–¹å¼3: ä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬
python quick_start.py  # è‡ªåŠ¨å¤„ç†çŽ¯å¢ƒæ£€æŸ¥å’ŒæœåŠ¡å¯åŠ¨
```

### 3. çŽ¯å¢ƒé…ç½®
```bash
# è®¾ç½®APIå¯†é’¥
export DEEPSEEK_API_KEY="your_deepseek_key"
export GLM_API_KEY="your_glm_key"
export OPENAI_API_KEY="your_openai_key"

# æˆ–ä½¿ç”¨.envæ–‡ä»¶
cat >> .env << EOF
DEEPSEEK_API_KEY=your_deepseek_key
GLM_API_KEY=your_glm_key
OPENAI_API_KEY=your_openai_key
EOF
```

## ðŸ“ˆ åŽç»­å‘å±•å»ºè®®

### 1. çŸ­æœŸä¼˜åŒ–
- **UI/UXæ”¹è¿›**ï¼šæ›´ç¾Žè§‚çš„å‰ç«¯ç•Œé¢è®¾è®¡
- **ç›‘æŽ§é¢æ¿**ï¼šæ›´è¯¦ç»†çš„æ€§èƒ½å’Œä½¿ç”¨ç›‘æŽ§
- **æµ‹è¯•æ‰©å±•**ï¼šæ›´å¤šçš„ä¸“é¡¹æµ‹è¯•åœºæ™¯è¦†ç›–
- **æ–‡æ¡£å®Œå–„**ï¼šAPIæ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

### 2. é•¿æœŸè§„åˆ’
- **å¤šæ¨¡æ€æ”¯æŒ**ï¼šå›¾åƒã€éŸ³é¢‘ç­‰å¤šæ¨¡æ€LLMé›†æˆ
- **å¾®è°ƒæ¨¡åž‹æ”¯æŒ**ï¼šè‡ªå®šä¹‰æ¨¡åž‹çš„é›†æˆæ”¯æŒ
- **åˆ†å¸ƒå¼æž¶æž„**ï¼šæ”¯æŒå¤§è§„æ¨¡éƒ¨ç½²å’Œè´Ÿè½½å‡è¡¡
- **ä¼ä¸šçº§åŠŸèƒ½**ï¼šæƒé™ç®¡ç†ã€è®¡è´¹ã€å®¡è®¡ç­‰

## ðŸ† é¡¹ç›®æ€»ç»“

### âœ… å·²å®Œæˆç›®æ ‡
- **âœ… DeepSeek APIé›†æˆ**ï¼šå®Œæ•´æ”¯æŒï¼Œæµ‹è¯•é€šè¿‡(72.2%æˆåŠŸçŽ‡)
- **âœ… GLM APIé›†æˆ**ï¼šå®Œæ•´æ”¯æŒï¼Œä¸­æ–‡ç†è§£èƒ½åŠ›ä¼˜ç§€
- **âœ… å¤šæä¾›å•†æž¶æž„**ï¼šçµæ´»çš„LLMæä¾›å•†åˆ‡æ¢èƒ½åŠ›
- **âœ… å®Œæ•´æµ‹è¯•å¹³å°**ï¼šç¾Žè§‚å‰ç«¯ + å¼ºå¤§åŽç«¯ + å…¨é¢æµ‹è¯•
- **âœ… ç”Ÿäº§å°±ç»ª**ï¼šå…·å¤‡å®Œæ•´çš„LLMé›†æˆèƒ½åŠ›ï¼Œå¯æŠ•å…¥ç”Ÿäº§ä½¿ç”¨

### ðŸŽ¯ æ ¸å¿ƒæˆå°±
1. **è§£å†³äº†åŽŸå§‹é—®é¢˜**ï¼šç³»ç»Ÿå·²å…·å¤‡çœŸå®žçš„å¤§è¯­è¨€æ¨¡åž‹èƒ½åŠ›
2. **è¶…å‡ºé¢„æœŸç›®æ ‡**ï¼šä¸ä»…æ”¯æŒDeepSeekï¼Œè¿˜å®žçŽ°äº†GLMã€OpenAIç­‰
3. **æŠ€æœ¯æž¶æž„ä¼˜ç§€**ï¼šæ¨¡å—åŒ–ã€å¯æ‰©å±•ã€é«˜æ€§èƒ½çš„è®¾è®¡
4. **ç”¨æˆ·ä½“éªŒä¼˜ç§€**ï¼šç›´è§‚çš„ç•Œé¢å’Œå¼ºå¤§çš„æµ‹è¯•åŠŸèƒ½

---

**ðŸ“Š é¡¹ç›®çŠ¶æ€ï¼šLLMé›†æˆåŠŸèƒ½å®Œæ•´ï¼Œæµ‹è¯•éªŒè¯é€šè¿‡ï¼Œç”Ÿäº§å°±ç»ªï¼**

**ðŸš€ å¯ä»¥å¼€å§‹åœ¨å„ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨é›†æˆçš„LLMèƒ½åŠ›äº†ï¼**