# Story 4.1: 主控制台界面开发

## Status
Draft

## Story

**As a** 现场指挥官,
**I want** 一个直观的主控制台界面,
**so that** 能够快速了解系统状态、监控关键指标、并访问核心功能。

## Acceptance Criteria

1. 主控制台能够展示系统整体状态和当前事件信息
2. 实时显示核心指标监控面板（水位、流量、救援进度、人员安全）
3. 提供Agent状态监控和快速导航功能
4. 支持紧急状态预警和通知系统
5. 实现响应式设计，适配不同屏幕尺寸

## Tasks / Subtasks

- [ ] 实现主控制台布局框架 (AC: #1)
  - [ ] 设计响应式布局系统
    - [ ] CSS Grid布局结构
    - [ ] 弹性盒子布局
    - [ ] 媒体查询适配
    - [ ] 断点设计管理
  - [ ] 创建顶部导航栏
    - [ ] 系统标题显示
    - [ ] 用户信息展示
    - [ ] 紧急状态指示器
    - [ ] 快速操作按钮
  - [ ] 实现侧边导航菜单
    - [ ] 功能模块导航
    - [ ] 折叠展开功能
    - [ ] 面包屑导航
    - [ ] 搜索功能
  - [ ] 创建主内容区域
    - [ ] 内容区域布局
    - [ ] 标签页管理
    - [ ] 内容滚动控制
    - [ ] 全屏切换功能
  - [ ] 设计底部状态栏
    - [ ] 系统状态信息
    - [ ] 连接状态指示
    - [ ] 版本信息显示
    - [ ] 快捷键提示

- [ ] 实现核心指标监控面板 (AC: #2)
  - [ ] 设计指标卡片组件
    - [ ] 指标数值显示
    - [ ] 趋势指示器
    - [ ] 单位和标签
    - [ ] 警戒线标识
  - [ ] 实现水位监测组件
    - [ ] 实时水位数据
    - [ ] 历史趋势图表
    - [ ] 警戒值设定
    - [ ] 变化率计算
  - [ ] 创建流量监测组件
    - [ ] 流量数据展示
    - [ ] 峰值标识
    - [ ] 预测值显示
    - [ ] 对比分析
  - [ ] 实现救援进度组件
    - [ ] 进度百分比显示
    - [ ] 任务完成状态
    - [ ] 时间轴展示
    - [ ] 里程碑标记
  - [ ] 创建人员安全组件
    - [ ] 安全状态指示
    - [ ] 人员统计信息
    - [ ] 失联人员提醒
    - [ ] 撤离进度显示

- [ ] 实现Agent状态监控 (AC: #3)
  - [ ] 设计Agent状态卡片
    - [ ] Agent类型标识
    - [ ] 运行状态指示
    - [ ] 置信度显示
    - [ ] 最后更新时间
  - [ ] 实现状态网格布局
    - [ ] 四Agent状态展示
    - [ ] 状态颜色编码
    - [ ] 动画过渡效果
    - [ ] 选中状态管理
  - [ ] 创建性能指标显示
    - [ ] 处理时间统计
    - [ ] 数据量统计
    - [ ] 错误率显示
    - [ ] 资源占用率
  - [ ] 实现Agent快速操作
    - [ ] 重启功能
    - [ ] 配置调整
    - [ ] 日志查看
    - [ ] 详情链接
  - [ ] 设计Agent协作可视化
    - [ ] 协作流程图
    - [ ] 数据流向指示
    - [ ] 状态同步显示
    - [ ] 异常状态提醒

- [ ] 实现事件信息展示 (AC: #4)
  - [ ] 设计事件概览组件
    - [ ] 事件标题显示
    - [ ] 事件类型标识
    - [ ] 严重程度指示
    - [ ] 持续时间统计
  - [ ] 实现影响区域信息
    - [ ] 地理位置显示
    - [ ] 影响范围统计
    - [ ] 人口影响数据
    - [ ] 基础设施状态
  - [ ] 创建救援资源统计
    - [ ] 救援队伍数量
    - [ ] 装备物资统计
    - [ ] 资源调配状态
    - [ ] 资源缺口提示
  - [ ] 实现事件时间线
    - [ ] 关键时间节点
    - [ ] 事件进展记录
    - [ ] 预测里程碑
    - [ ] 历史对比
  - [ ] 设计快速操作面板
    - [ ] 常用功能快捷入口
    - [ ] 紧急操作按钮
    - [ ] 场景切换功能
    - [ ] 设置调整入口

- [ ] 实现实时数据更新和预警 (AC: #5)
  - [ ] 设计数据更新机制
    - [ ] WebSocket连接管理
    - [ ] 数据订阅机制
    - [ ] 更新频率控制
    - [ ] 错误重连机制
  - [ ] 实现实时数据同步
    - [ ] 数据状态管理
    - [ ] 增量更新处理
    - [ ] 数据冲突解决
    - [ ] 本地缓存策略
  - [ ] 创建预警系统
    - [ ] 预警规则配置
    - [ ] 预警级别管理
    - [ ] 预警通知方式
    - [ ] 预警历史记录
  - [ ] 实现通知组件
    - [ ] 通知消息展示
    - [ ] 通知类型分类
    - [ ] 通知优先级排序
    - [ ] 通知操作处理
  - [ ] 设计系统健康监控
    - [ ] 系统状态检查
    - [ ] 性能指标监控
    - [ ] 异常状态检测
    - [ ] 自动恢复机制

## Dev Notes

### 技术要点
- 采用React 18 + TypeScript作为前端框架
- 使用Ant Design 5提供UI组件支持
- 通过Redux Toolkit进行状态管理
- 集成ECharts + D3.js实现数据可视化
- 使用Socket.IO Client建立实时通信连接
- 采用CSS Modules + Styled Components管理样式

### 核心功能模块
- **系统状态监控**: 实时显示整体系统运行状态
- **Agent状态展示**: 监控S-A-F-E四Agent的运行状态
- **核心指标面板**: 展示水位、流量、救援进度、人员安全等关键指标
- **事件信息展示**: 显示当前应急事件的基本信息
- **通知中心**: 集中管理和显示系统通知和预警

### 布局结构设计
- **顶部导航栏**: 系统标题、状态指示、用户操作区
- **事件概览区**: 当前事件的详细信息展示
- **指标面板区**: 四个核心指标的实时监控卡片
- **Agent监控区**: 四个Agent的状态监控卡片网格
- **通知区域**: 重要通知和预警信息的集中展示
- **底部状态栏**: 系统更新时间、连接状态、版本信息

### 开发工作流程
1. 设计响应式布局框架和导航系统
2. 实现核心指标监控面板组件
3. 开发Agent状态监控和可视化
4. 创建事件信息展示和快速操作
5. 实现WebSocket实时数据更新
6. 建立预警系统和通知机制
7. 优化性能和用户体验
8. 进行跨设备兼容性测试

### 依赖关系说明
- 依赖Story 3.1-3.7的后端API服务
- 需要WebSocket实时数据推送服务
- 依赖Ant Design组件库和图表库
- 为其他界面组件提供基础框架

### 重要注意事项
- 界面需要支持实时数据更新和状态同步
- 指标展示需要考虑数据可视化的直观性
- Agent状态需要准确的运行状态反映
- 预警系统需要及时准确的通知机制
- 响应式设计需要适配各种设备屏幕

### 测试策略
- 单元测试: 测试各组件的功能正确性
- 集成测试: 测试数据流和状态管理
- 端到端测试: 测试完整的用户交互流程
- 性能测试: 测试实时数据更新的性能
- 可用性测试: 验证用户体验和易用性

### Testing

#### 测试标准
- 测试文件位置: tests/dashboard/目录
- 布局测试: 验证响应式布局的正确性
- 指标展示测试: 验证数据显示的准确性
- 实时更新测试: 验证WebSocket数据同步
- Agent状态测试: 验证Agent状态监控功能

#### 测试框架和模式
- 单元测试: Jest + React Testing Library
- 集成测试: Cypress + Mock Service Worker
- 端到端测试: Playwright
- 视觉回归测试: Chromatic + Storybook

#### 特定测试要求
- 实时数据更新的稳定性测试
- 大数据量渲染的性能测试
- 长时间运行的稳定性测试
- 多设备适配的兼容性测试
- 网络异常情况的处理测试

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-20 | 1.0 | 初始故事创建 | John (PM) |

## Dev Agent Record

### Agent Model Used
(待开发时填写)

### Debug Log References
(待开发时填写)

### Completion Notes List
(待开发时填写)

### File List
(待开发时填写)

## QA Results
(待QA测试时填写)